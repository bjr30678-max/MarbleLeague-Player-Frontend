<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>彈珠聯賽 - LINE LIFF</title>

    <!-- Meta Tags for Security -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://static.line-scdn.net https://cdn.socket.io https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https: blob:;
        font-src 'self' data:;
        connect-src 'self' https://api.bjr8888.com wss://api.bjr8888.com wss://stream.bjr8888.com https://stream.bjr8888.com;
        media-src 'self' https://stream.bjr8888.com blob:;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="彈珠聯賽">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="src/css/variables.css">
    <link rel="stylesheet" href="src/css/main.css">

    <!-- External Scripts -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ovenplayer@0.10.16/dist/ovenplayer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <!-- 載入畫面 -->
    <div id="loading" class="loading-overlay show">
        <div class="spinner"></div>
    </div>

    <!-- 主應用 -->
    <div class="app" id="app">
        <!-- Header -->
        <header class="header">
            <h1>🎱 彈珠聯賽</h1>
            <div class="user-info">
                <img id="userAvatar" class="user-avatar" src="https://via.placeholder.com/40" alt="用戶頭像">
                <span id="userName">載入中...</span>
            </div>
            <div class="balance-display">
                積分：<span id="userBalance">0</span>
            </div>
        </header>

        <!-- 導航標籤 -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="gaming">遊戲</button>
            <button class="nav-tab" data-tab="live">直播</button>
            <button class="nav-tab" data-tab="history">記錄</button>
            <button class="nav-tab" data-tab="profile">個人</button>
        </nav>

        <!-- 內容區域 -->
        <main class="content">
            <!-- 遊戲頁面 -->
            <div id="gaming" class="page active">
                <!-- 倒數計時 -->
                <div class="countdown">
                    <div id="roundDisplay">第 - 期</div>
                    <div id="countdown" class="countdown-timer">--:--</div>
                    <div id="countdownLabel">等待開始...</div>
                </div>

                <!-- 投注區域 -->
                <div id="bettingArea">
                    <!-- 投注金額選擇 -->
                    <div class="bet-amount-selector">
                        <div class="amount-selector-title">投注金額</div>
                        <div class="amount-buttons">
                            <button class="amount-btn" onclick="setBetAmount(10)">10</button>
                            <button class="amount-btn" onclick="setBetAmount(50)">50</button>
                            <button class="amount-btn active" onclick="setBetAmount(100)">100</button>
                            <button class="amount-btn" onclick="setBetAmount(500)">500</button>
                            <button class="amount-btn" onclick="setBetAmount(1000)">1000</button>
                        </div>
                        <div class="current-amount">
                            當前金額：<span id="currentAmountDisplay">100</span> 積分
                        </div>
                    </div>

                    <!-- 投注類型 - 預留位置 -->
                    <div id="betTypeContainer">
                        <p style="text-align: center; color: #999; padding: 40px 0;">
                            請等待新回合開始...
                        </p>
                    </div>
                </div>

                <!-- 投注摘要 -->
                <div id="betSummary">
                    <p class="no-bets">尚未選擇投注項目</p>
                </div>

                <!-- 提交按鈕 -->
                <div style="text-align: center; margin-top: 20px;">
                    <button id="submitBtn" class="btn btn-primary" disabled>
                        提交投注
                    </button>
                </div>
            </div>

            <!-- 直播頁面 -->
            <div id="live" class="page">
                <div class="live-status offline">離線</div>

                <!-- 直播播放器 -->
                <div id="livePlayer"></div>

                <!-- 播放器控制 -->
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-secondary" onclick="togglePlay()">播放/暫停</button>
                    <button class="btn btn-secondary" onclick="toggleMute()">靜音/取消靜音</button>
                    <button class="btn btn-secondary" onclick="refreshStream()">重新整理</button>
                </div>

                <!-- 賽事資訊 -->
                <div id="raceInfo" style="margin-top: 20px;">
                    <h3>當前賽事</h3>
                    <p id="raceInfoContent">載入中...</p>
                </div>
            </div>

            <!-- 歷史記錄頁面 -->
            <div id="history" class="page">
                <h2>歷史記錄</h2>
                <div id="historyList">
                    <p style="text-align: center; color: #999; padding: 40px 0;">
                        載入中...
                    </p>
                </div>
            </div>

            <!-- 個人頁面 -->
            <div id="profile" class="page">
                <h2>個人資訊</h2>
                <div id="profileContent">
                    <p style="text-align: center; color: #999; padding: 40px 0;">
                        載入中...
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content" id="modalContent">
            <!-- Modal content will be inserted here -->
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Main Application Script (ES6 Module) -->
    <script type="module" src="src/js/app.js"></script>
</body>
</html>
